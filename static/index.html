<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Copyright (C) 2023  Martijn van der Kleijn - This file is part of HomeDash.

    This Source Code Form is subject to the terms of the Mozilla Public
  	License, v. 2.0. If a copy of the MPL was not distributed with this
  	file, You can obtain one at http://mozilla.org/MPL/2.0/.
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Home Dashboard</title>
    <script src="/static/vue.min.js"></script>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <template id="my-component">
        <a :href="url" class="app-card" target="_blank">
            <img :src="icon">
            <div class="app-text">
                <h2>{{ name }}</h2>
                <p v-if="comment">{{ comment }}</p>
            </div>
        </a>
    </template>

    <button id="theme-toggle-button">Toggle Theme</button>

    <section id="app" class="app-grid">
        <p v-if="noContainers" style="color: var(--text);">No containers found.</p>
    </section>

    <script>
        Vue.component('my-component', {
            props: ['name', 'url', 'icon', 'comment'],
            template: '#my-component'
        })

        new Vue({
            el: '#app',
            data: {
                noContainers: false
            },
            created: function () {
                fetch('/api/v1/applications')
                    .then(response => response.json())
                    .then(data => {
                        if (!data || data.length === 0) {
                            this.noContainers = true;
                            return;
                        }
                        for (let item of data) {
                            const myComponent = new Vue({
                                render: h => h('my-component', {
                                    props: {
                                        name: item.name,
                                        icon: item.iconFile,
                                        url: item.url,
                                        comment: item.comment
                                    }
                                })
                            })

                            this.$el.appendChild(myComponent.$mount().$el)
                        }
                    })
                    .catch(error => console.error(error))
            }
        })
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const themeToggleButton = document.getElementById('theme-toggle-button');
            const body = document.body;

            // Check for a saved theme preference (optional, but good for persistence)
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                body.classList.add('light');
            }

            themeToggleButton.addEventListener('click', () => {
                body.classList.toggle('light');

                // Save preference (optional)
                if (body.classList.contains('light')) {
                    localStorage.setItem('theme', 'light');
                } else {
                    localStorage.setItem('theme', 'dark');
                }
            });
        });
    </script>
</body>

</html>
